(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{G:()=>R,x:()=>N});var t=document.querySelector("#pop-up-edit-profile"),n=document.querySelector("#pop-up-edit-avatar"),r=document.querySelector("#edit-form-avatar"),o=document.querySelector("#pop-up-delete-picture"),c=(document.querySelector("#edit-form-avatar"),document.querySelector(".profile__button-edit")),u=t.querySelector(".pop-up__form"),a=u.querySelector("#name"),i=u.querySelector("#description"),l=document.querySelector(".profile"),s=l.querySelector(".profile__name"),d=l.querySelector(".profile__status"),p=l.querySelector(".profile__avatar"),f=document.querySelector(".table"),v=document.querySelector("#template-card").content,_=document.querySelector("#pop-up-edit-picture"),m=document.querySelector(".profile__button-add"),y=document.querySelector("#edit-form-picture"),h=document.querySelector(".picture"),b=t.querySelector("#name"),S=t.querySelector("#description"),q=_.querySelector("#name"),g=_.querySelector("#description"),L=h.querySelector("#name"),E=h.querySelector("#description"),k=y.querySelector("#name"),x=y.querySelector("#description"),C=r.querySelector("#url"),U=function(e,t){Array.from(e.elements).filter((function(e){return"INPUT"===e.nodeName})).forEach((function(n){w(e,n,t)}))},w=function(e,t,n){var r=e.querySelector(".pop-up__text-".concat(t.id,"-error"));t.classList.remove(n),r.textContent=""},A=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",!0))};function T(e){e.classList.remove("pop-up_opened"),e.removeEventListener("mousedown",D),document.removeEventListener("keydown",O)}function P(e){e.classList.add("pop-up_opened"),e.addEventListener("mousedown",D),document.addEventListener("keydown",O)}function O(e){"Escape"===e.key&&T(document.querySelector(".pop-up_opened"))}function D(e){(e.target.classList.contains("pop-up")||e.target.classList.contains("popup__close"))&&T(e.currentTarget)}var N,j,B={baseUrl:"https://nomoreparties.co/v1/plus-cohort-18/",headers:{authorization:"95e1c598-7d7b-4945-aa63-eed177f7d6d7","Content-Type":"application/json"}},I=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function J(e,t){e.textContent=t?"Сохранение...":"Сохраненить"}function M(e,t){e.textContent=t?"Удаление...":"Да"}function H(e){P(o),o.id=e.target.parentElement.id,o.card=e.target.closest(".table__card"),o.addEventListener("submit",G)}function z(e,t){(function(e,t){return fetch("".concat(B.baseUrl,"cards/likes/").concat(t),{method:e,headers:B.headers}).then((function(e){return I(e)}))})(e,t.id).then((function(e){t.textContent=e.likes.length})).catch((function(e){return console.log(e)}))}function G(e){e.preventDefault();var t,n=e.target.querySelector(".pop-up__button-save");return M(n,!0),(t=o.id,fetch("".concat(B.baseUrl,"cards/").concat(t),{method:"DELETE",headers:B.headers}).then((function(e){return I(e)}))).then((function(){o.card.remove(),T(o),o.removeEventListener("submit",G)})).catch((function(e){return console.log(e)})).finally((function(){return M(n,!1)}))}function F(e){var t=e.target.parentElement.querySelector(".table__like");e.target.classList.contains("table__button-like_active")?z("DELETE",t):z("PUT",t),e.target.classList.toggle("table__button-like_active")}function K(e,t,n,r,o,c){var u=v.querySelector(".table__card").cloneNode(!0);u.id=t;var a=u.querySelector(".table__photo"),i=u.querySelector(".table__like");a.src=r,a.alt=n,i.textContent=o.length,i.id=t,u.querySelector(".table__name").textContent=n;var l=u.querySelector(".table__button-like");c&&l.classList.add("table__button-like_active"),l.addEventListener("click",F);var s=u.querySelector(".table__button-remove");return s.addEventListener("click",H),N===e&&s.classList.add("table__button-remove_active"),a.addEventListener("click",(function(){P(h),R(r,n)})),u}function Q(){C.value=""}function R(e,t){L.src=e,L.alt=t,E.textContent=t}function V(e){s.textContent=e.name,d.textContent=e.about,p.src=e.avatar,N=e._id}j={formSelector:".pop-up__form",inputSelector:".pop-up__text",submitButtonSelector:".pop-up__button-save",inputInvalid:"pop-up__text_invalid",inactiveButtonClass:"pop-up__button_save_type-inactive",errorClass:"pop-up__text-error"},Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);A(n,r,t.inactiveButtonClass),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?w(e,t,n):function(e,t,n,r){var o=e.querySelector(".pop-up__text-".concat(t.id,"-error"));o&&(t.classList.add(r),t.validity.patternMismatch&&(n=t.dataset.errorMessage),n&&(o.textContent=n))}(e,t,t.validationMessage,n)}(e,o,t.inputInvalid),A(n,r,t.inactiveButtonClass)}))}))}(e,j)})),fetch("".concat(B.baseUrl,"users/me"),{headers:B.headers}).then((function(e){return I(e)})).then((function(e){return V(e)})).then((function(){return fetch("".concat(B.baseUrl,"cards"),{headers:B.headers}).then((function(e){return I(e)})).then((function(e){e.forEach((function(e){f.append(K(e.owner._id,e._id,e.name,e.link,e.likes,e.likes.some((function(t){return t._id===e.owner._id}))))}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})),c.addEventListener("click",(function(){b.value=s.textContent,S.value=d.textContent,U(u,"pop-up__text_invalid"),P(t)})),m.addEventListener("click",(function(){q.value="",g.value="",U(y,"pop-up__text_invalid"),P(_)})),p.addEventListener("click",(function(){Q(),U(r,"pop-up__text_invalid"),P(n)})),u.addEventListener("submit",(function(e){e.preventDefault();var n,r,o=e.target.querySelector(".pop-up__button-save");J(o,!0),(n=a.value,r=i.value,fetch("".concat(B.baseUrl,"users/me"),{method:"PATCH",body:JSON.stringify({name:n,about:r}),headers:B.headers}).then((function(e){return I(e)}))).then((function(e){V(e),T(t)})).catch((function(e){return console.log(e)})).finally((function(){return J(o,!1)}))})),y.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.target.querySelector(".pop-up__button-save");J(n,!0),(t={name:k.value,link:x.value},function(e){return fetch("".concat(B.baseUrl,"cards"),{method:"POST",body:JSON.stringify(e),headers:B.headers}).then((function(e){return I(e)}))}(t).then((function(e){return f.prepend(K(e.owner._id,e._id,e.name,e.link,e.likes,e.likes.some((function(t){return t._id===e.owner._id}))))})).catch((function(e){return console.log(e)}))).then((function(){T(_)})).catch((function(e){return console.log(e)})).finally((function(){return J(n,!1)}))})),r.addEventListener("submit",(function(e){e.preventDefault();var t,r=e.target.querySelector(".pop-up__button-save");J(r,!0),(t=C.value,fetch("".concat(B.baseUrl,"users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:t}),headers:B.headers}).then((function(e){return I(e)}))).then((function(e){p.src=e.avatar,T(n),Q(),J(r,!1)})).catch((function(e){return console.log(e)})).finally((function(){return J(r,!1)}))}))})();