(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Gw:()=>H,xS:()=>A});var t=document.querySelector("#pop-up-edit-profile"),n=document.querySelector("#pop-up-edit-avatar"),o=document.querySelector("#edit-form-avatar"),r=document.querySelector("#pop-up-delete-picture"),c=(document.querySelector("#edit-form-avatar"),document.querySelector(".profile__button-edit")),a=t.querySelector(".pop-up__form"),u=a.querySelector("#name"),i=a.querySelector("#description"),s=document.querySelector(".profile"),l=s.querySelector(".profile__name"),d=s.querySelector(".profile__status"),p=s.querySelector(".profile__avatar"),f=document.querySelector(".table"),v=document.querySelector("#template-card").content,m=document.querySelector("#pop-up-edit-picture"),_=document.querySelector(".profile__button-add"),h=document.querySelector("#edit-form-picture"),y=document.querySelector(".picture"),S=t.querySelector("#name"),b=t.querySelector("#description"),q=m.querySelector("#name"),g=m.querySelector("#description"),k=y.querySelector("#name"),L=y.querySelector("#description"),E=h.querySelector("#name"),C=h.querySelector("#description"),x=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",!0))};function j(e){e.classList.remove("pop-up_opened"),e.removeEventListener("mousedown",U),document.removeEventListener("keydown",w)}function P(e){e.classList.add("pop-up_opened"),e.addEventListener("mousedown",U),document.addEventListener("keydown",w)}function w(e){"Escape"===e.key&&j(document.querySelector(".pop-up_opened"))}function U(e){(e.target.classList.contains("pop-up")||e.target.classList.contains("popup__close"))&&j(e.currentTarget)}var A,T,O={baseUrl:"https://nomoreparties.co/v1/plus-cohort-18/",headers:{authorization:"95e1c598-7d7b-4945-aa63-eed177f7d6d7","Content-Type":"application/json"}};function D(e){P(r),r.id=e.target.parentElement.id,r.card=e.target.closest(".table__card"),r.addEventListener("submit",N)}function B(e,t){(function(e,t){return fetch("".concat(O.baseUrl,"cards/likes/").concat(t),{method:e,headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))})(e,t.id).then((function(e){t.textContent=e.likes.length})).catch((function(e){return console.log(e)}))}function N(e){e.preventDefault();var t,n=e.target.querySelector(".pop-up__button-save");return n.textContent="Удаление...",(t=r.id,fetch("".concat(O.baseUrl,"cards/").concat(t),{method:"DELETE",headers:O.headers}).then((function(e){return e.ok?Promise.resolve():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(){r.card.remove(),j(r),r.removeEventListener("submit",N),n.textContent="Удалить"})).catch((function(e){return console.log(e)}))}function J(e){var t=e.target.parentElement.querySelector(".table__like");e.target.classList.contains("table__button-like_active")?B("DELETE",t):B("PUT",t),e.target.classList.toggle("table__button-like_active")}function M(e,t,n,o,r,c){var a=v.querySelector(".table__card").cloneNode(!0);a.id=t;var u=a.querySelector(".table__photo"),i=a.querySelector(".table__like");u.src=o,u.alt=n,i.textContent=r.length,i.id=t,a.querySelector(".table__name").textContent=n;var s=a.querySelector(".table__button-like");c&&s.classList.add("table__button-like_active"),s.addEventListener("click",J);var l=a.querySelector(".table__button-remove");return l.addEventListener("click",D),A===e&&l.classList.add("table__button-remove_active"),u.addEventListener("click",(function(){P(y),H(o,n)})),a}function H(e,t){k.src=e,k.alt=t,L.textContent=t}function I(e){return l.textContent=e.name,d.textContent=e.about,p.src=e.avatar,A=e._id,Promise.resolve()}T={formSelector:".pop-up__form",inputSelector:".pop-up__text",submitButtonSelector:".pop-up__button-save",inputInvalid:"pop-up__text_invalid",inactiveButtonClass:"pop-up__button_save_type-inactive",errorClass:"pop-up__text-error"},Array.from(document.querySelectorAll(T.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);x(n,o,t.inactiveButtonClass),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".pop-up__text-".concat(t.id,"-error"));t.classList.remove(n),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".pop-up__text-".concat(t.id,"-error"));r&&(t.classList.add(o),t.validity.patternMismatch&&(n=t.dataset.errorMessage),n&&(r.textContent=n))}(e,t,t.validationMessage,n)}(e,r,t.inputInvalid),x(n,o,t.inactiveButtonClass)}))}))}(e,T)})),fetch("".concat(O.baseUrl,"users/me"),{headers:O.headers}).then((function(e){return e.ok?e.json():new Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)})).then((function(e){return I(e)})).then((function(){return fetch("".concat(O.baseUrl,"cards"),{headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)})).then((function(e){e.forEach((function(e){f.append(M(e.owner._id,e._id,e.name,e.link,e.likes,e.likes.some((function(t){return t._id===e.owner._id}))))}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})),c.addEventListener("click",(function(){P(t),S.value=l.textContent,b.value=d.textContent})),_.addEventListener("click",(function(){P(m),q.value="",g.value=""})),p.addEventListener("click",(function(){P(n)})),a.addEventListener("submit",(function(e){e.preventDefault();var n,o,r=e.target.querySelector(".pop-up__button-save");r.textContent="Сохранение...",(n=u.value,o=i.value,fetch("".concat(O.baseUrl,"users/me"),{method:"PATCH",body:JSON.stringify({name:n,about:o}),headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(e){I(e),j(t),r.textContent="Сохранить"})).catch((function(e){return console.log(e)}))})),h.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.target.querySelector(".pop-up__button-save");n.textContent="Создание...",(t={name:E.value,link:C.value},function(e){return fetch("".concat(O.baseUrl,"cards"),{method:"POST",body:JSON.stringify(e),headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}(t).then((function(e){return f.prepend(M(e.owner._id,e._id,e.name,e.link,e.likes,e.likes.some((function(t){return t._id===e.owner._id}))))})).catch((function(e){return console.log(e)}))).then((function(){j(m),n.textContent="Создать"})).catch((function(e){return console.log(e)}))})),o.addEventListener("submit",(function(e){e.preventDefault();var t,r=e.target.querySelector(".pop-up__button-save");r.textContent="Обновление...",(t=o.querySelector("#url").value,fetch("".concat(O.baseUrl,"users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:t}),headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(e){p.src=e.avatar,r.textContent="Сохранить",j(n)})).catch((function(e){return console.log(e)}))}))})();